---
title: "Gov 50 Final Project"
author: "William Tan"
description: "GOV50 Final Project"
output:
  distill::distill_article:
    self_contained: false
---

## Milestone 2: Project Thoughts

I am interested in exploring data related to basketball, in particular how offensive, defensive, and off-ball statistics influence a player's impact on the game. Alternatively, I'm interested in analyzing data about student debt and how that affects future choices, such as buying a home. Finally, I am possibly interested in looking at food price data and how that affects consumer choices.

Sports players and coaches often emphasize that “defense wins championships.” I want to analyze whether points above average per 100 possessions added by a player on defense have a correlative relationship with how many wins a player’s team accumulates during a season. To analyze this impact I am using a data set that utilizes a sports metric system called RAPTOR. RAPTOR is a plus-minus statistic that measures the number of points a player contributes to his team’s offense and defense per 100 possessions, relative to a league-average player. My hypothesis is that players with a greater number of points above average per 100 possessions on defense over the course of their career will impact the course of their team’s season and how many wins a team accrues. My sample is comprised of all NBA players from the 2014 season onward and tracks their statistics each year they play in the NBA. My unit of analysis is a particular player on a team during a season (i.e. Precious Achiuwa on the Toronto Raptors during the 2022 season). My explanatory variable of interest is the defense point statistics for that player, which is measured in points above average for 100 possessions (thereby indicating an “effective” performance on defense). This is a variable called raptor_onoff_defense which utilizes plus-minus impact data. For context, plus−minus is a sports statistic used to measure a player's impact, represented by the difference between their team's total scoring versus their opponent's when the player is in the game. My outcome variable is the number of wins a team receives in a season. This variable is simply numeric, with a higher number indicating a greater number of wins and a more positive team performance across the season. If I observe a greater number of wins with a positive average defensive points statistic for a player across their career, this would provide support for my hypothesis that players’ defense impacts the margin by which their team wins games. If, on the other hand, I see fewer defensive points stats impacting the number of wins, my hypothesis is incorrect. When I run my regression of the two variables, a positive, significant coefficient would indicate support for my hypothesis.

##Milestone 3: Data Visualization

```{r, fig.width = 10}
library(tidyverse)
library(infer)
raptor <- read.csv("latest_RAPTOR_by_team.csv")

team_raptor <- raptor |>
  filter(season_type == "PO")|>
  ggplot(mapping = aes(x = team, y = raptor_defense))+
  geom_boxplot()+
  labs(
    x = "Playoff Teams 2022-2023 Season",
    y = "RAPTOR Defense Rating (box score and on-off)",
    title = "RAPTOR Defense Rating by NBA Playoff Team"
  )
team_raptor
```



This boxplots models the spread of RAPTOR defensive ratings for members of an NBA playoff team during the 2022-2023 season. The x-axis has all 16 teams in the playoffs and the y-axis has the measure for defensive rating (which includes both the box score value and the on-off value). 
```{r, fig.width = 15}

clippers_raptor <- raptor |>
  filter(season_type == "PO", team == "LAC")|>
  group_by(team)|>
  ggplot(mapping = aes(x = player_name, y = raptor_defense))+
  geom_point()+
  labs(
    x = "LA Clippers Player Name",
    y = "RAPTOR Defense Rating (box score and on-off)",
    title = "RAPTOR Defense Rating for the 2023 Los Angeles Clippers Playoff Basketball Team"
  )
clippers_raptor

```



Looking at a specific team in the playoffs, the LA Clippers, this plot calculates the defensive rating for each player individually. This hopes to isolate the defensive impact of each player, such that the team's defensive ratings aren't clouded by the fact that some players' exceptional defensive impacts the team's rating as a whole.


## Milestone 4: 
Analysis: Impact of defensive rating on postseason win rate.

```{r}
raptor <- raptor|>
  filter(season_type == "PO")|>
  group_by(team)


avg_defensive_stats_postseason <- raptor|>
  summarize(mean_box_defense = mean(raptor_box_defense), mean_onoff_defense = mean(raptor_onoff_defense), mean_raptor_defense = mean(raptor_defense), mean_predator_defense = mean(predator_defense))
avg_defensive_stats_postseason


postseason_wins_raptor <- raptor |>
  summarize(mean_defense = mean(raptor_defense))|>
  pivot_wider(
    names_from = team,
    values_from = mean_defense
  )|>
  knitr::kable(digits = 2)
postseason_wins_raptor

mean_defense_value <- raptor |>
  mutate(mean_defense = mean(raptor_defense))
mean_defense_value


fit_1 <- lm(mean_defense ~ war_playoffs, data = mean_defense_value) 
fit_1 

```
I first filtered the data to only 16 NBA teams that competed in the postseason. Then, I grouped the data by teams and used this calculated the average defensive rating for each type of defensive category (box-defense, on_off defense, the combination of the two, and finally, the predicted defensive rating). For reference, the variable raptor_box_defense calculates the points above average per 100 possessions added by player on defense, based only on box score estimate. The variable raptor_onoff_defense calculates the points above average per 100 possessions added by player on defense, based only on plus-minus data, and the raptor_defense values are the points above average per 100 possessions added by player on defense, using both box and on-off components.

Then, I calculated the average defensive point value for each team separately and visualized that in a knitted and pivoted table for all 16 NBA teams. 

Finally, I ran a regression analysis on the effect of average defensive impact on postseason playoff wins to see if there was a stastically significant relationship. By taking the linear regression of average raptor defense on playoffs wins, we find a positive coefficient of 0.03405. This means that on average, for an increase of 1 point above average per 100 posessions added by a player on defense, there will be a 0.03405 positive increase in wins above replacement during the playoffs. This means that there is a positive relationship between the average number of points converted because of defense on how many wins a team received in the postseason, thereby affirming my hypothesis in part that defense is essential to winning championships.

